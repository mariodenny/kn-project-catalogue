<%- include('partials/header') %>

<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-8 text-center">Browse Projects</h1>

    <!-- Search and Filter -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <form method="GET" action="/projects" class="flex flex-col md:flex-row gap-4">
            <div class="flex-1">
                <input type="text" name="search" value="<%= search || '' %>" 
                    placeholder="Search by project name or teacher..."
                    class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <!-- <div class="flex-1">
                <select name="category" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">All Categories</option>
                    <option value="Scratch" <%= category === 'Scratch' ? 'selected' : '' %>>Scratch</option>
                    <option value="Website" <%= category === 'Website' ? 'selected' : '' %>>Website</option>
                    <option value="Roblox" <%= category === 'Roblox' ? 'selected' : '' %>>Roblox</option>
                </select>
            </div>
            <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition">
                Filter
            </button>
            <a href="/projects" class="bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600 transition text-center">
                Clear
            </a> -->
        </form>
    </div>

    <!-- Projects Grid -->
    <% if (projects.length > 0) { %>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            <% projects.forEach(project => { %>
                <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition">
                    <% if (project.screenshots && project.screenshots.length > 0) { %>
                        <img src="/uploads/<%= project.screenshots[0] %>" 
                             alt="<%= project.projectName %>" 
                             class="w-full h-48 object-cover">
                    <% } else { %>
                        <div class="w-full h-48 bg-gray-200 flex items-center justify-center">
                            <span class="text-gray-500">No Image</span>
                        </div>
                    <% } %>
                    
                    <div class="p-4">
                        <h3 class="text-xl font-semibold text-gray-800 mb-2"><%= project.projectName %></h3>
                        <div class="space-y-2 text-sm text-gray-600">
                            <% if (project.studentName) { %>
                                <p><strong>Student:</strong> <%= project.studentName %></p>
                            <% } %>
                            <% if (project.moduleName) { %>
                                <p><strong>Module:</strong> <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs"><%= project.moduleName %></span></p>
                            <% } %>
                            <% if (project.teacherName) { %>
                                <p><strong>Teacher:</strong> <%= project.teacherName %></p>
                            <% } %>
                            <% if (project.projectLink) { %>
                                <p>
                                    <a href="<%= project.projectLink %>" target="_blank" 
                                       class="text-blue-600 hover:text-blue-800 underline">
                                        View Project
                                    </a>
                                </p>
                            <% } %>
                        </div>
                        
                        <% if (project.screenshots && project.screenshots.length > 0) { %>
                            <div class="mt-4 flex space-x-2">
                                <% project.screenshots.forEach((screenshot, index) => { %>
                                    <img src="/uploads/<%= screenshot %>" 
                                         alt="Screenshot <%= index + 1 %>"
                                         class="w-16 h-16 object-cover rounded border cursor-pointer"
                                         onclick="openImage('/uploads/<%= screenshot %>')">
                                <% }) %>
                            </div>
                        <% } %>
                    </div>
                </div>
            <% }) %>
        </div>
    <% } else { %>
        <div class="text-center py-12">
            <p class="text-xl text-gray-600">No projects found. Be the first to <a href="/upload" class="text-blue-600 underline">upload a project</a>!</p>
        </div>
    <% } %>
</div>

<!-- Image Modal -->
<div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50">
    <div class="max-w-4xl max-h-full">
        <img id="modalImage" src="" alt="" class="max-w-full max-h-full">
        <button onclick="closeImage()" class="absolute top-4 right-4 text-white text-2xl bg-black bg-opacity-50 rounded-full w-10 h-10 flex items-center justify-center">
            Ã—
        </button>
    </div>
</div>

<script>
function openImage(src) {
    document.getElementById('modalImage').src = src;
    document.getElementById('imageModal').classList.remove('hidden');
    document.getElementById('imageModal').classList.add('flex');
}

function closeImage() {
    document.getElementById('imageModal').classList.add('hidden');
    document.getElementById('imageModal').classList.remove('flex');
}

// Close modal on background click
document.getElementById('imageModal').addEventListener('click', function(e) {
    if (e.target === this) closeImage();
});
</script>

<%- include('partials/footer') %>